if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){if(this==null){throw new TypeError()}var d=Object(this);var a=d.length>>>0;if(a===0){return -1}var e=0;if(arguments.length>0){e=Number(arguments[1]);if(e!=e){e=0}else{if(e!=0&&e!=Infinity&&e!=-Infinity){e=(e>0||-1)*Math.floor(Math.abs(e))}}}if(e>=a){return -1}var b=e>=0?e:Math.max(a-Math.abs(e),0);for(;b<a;b++){if(b in d&&d[b]===c){return b}}return -1}}jQuery.noConflict();(function(window,$){var console=window.console||{log:function(){},warn:function(){},error:function(){}};var Formstack=window.Formstack||{};Formstack.Form=function(id){this.id=id;this.currentPage=1;this.pages=$("div.fsPage").length;this.logicFields=[];this.checks=[];this.hasHtml5Validation=typeof document.createElement("input").validity=="object";this.jsonp=false;this.calculations=[];this.calcFields=[];this.validate=true;if(this.pages>1){$("#fsNextButton"+this.id).click($.proxy(this.nextPage,this));$("#fsPreviousButton"+this.id).click($.proxy(this.previousPage,this))}if(!this.hasHtml5Validation){document.getElementById("fsForm"+this.id).novalidate=false}this.plugins={}};Formstack.Form.prototype.resetSubmitButton=function(){var submitButton=document.getElementById("fsSubmitButton"+this.id);var langDiv=document.getElementById("submitButtonText");if(submitButton&&langDiv){submitButton.value=langDiv.innerHTML}};Formstack.Form.prototype.isLastPage=function(page){if(this.pages==1){return true}var lastPage=1;for(var i=1;i<=this.pages;i++){if(this.pageIsVisible(i)){lastPage=i}}return page==lastPage};Formstack.Form.prototype.nextPage=function(){if(this.currentPage+1>this.pages){return}var pageValid=this.checkPage(this.currentPage);if(!pageValid){console.error("Page failed validation.");return}var currPage=document.getElementById("fsPage"+this.id+"-"+this.currentPage);var skipAhead=1;while(!this.pageIsVisible(this.currentPage+skipAhead)&&(this.currentPage+skipAhead)<this.pages){skipAhead++}this.currentPage+=skipAhead;var nextPage=document.getElementById("fsPage"+this.id+"-"+this.currentPage);this.updateProgress(this.currentPage);if(this.currentPage==this.pages||this.isLastPage(this.currentPage)){if(this.plugins.confirmationPage!=null){this.plugins.confirmationPage.parsePage()}$("#fsCaptcha"+this.id).show();$("#fsSubmitButton"+this.id).show();$("#fsNextButton"+this.id).hide()}else{$("#fsSaveIncomplete"+this.id).show()}var scope=this;$(currPage).fadeOut(200,function(){$(currPage).addClass("fsHiddenPage");$("#fsPreviousButton"+scope.id).show();$(nextPage).removeClass("fsHiddenPage");$(nextPage).show();var signatures=$(nextPage).find(".fsSignature");for(var i=0;i<signatures.length;i++){if($(signatures[i]).height()<=30){$(signatures[i]).empty();$(signatures[i]).jSignature()}}if($("#fsHeaderImage").length<=0){$(document).scrollTop($(nextPage).offset().top-Number($(".fsForm").css("margin-top").replace("px","")))}else{$(document).scrollTop($("#fsHeaderImage").offset().top)}})};Formstack.Form.prototype.previousPage=function(event){if(this.currentPage-1==0){return}var currentPage=document.getElementById("fsPage"+this.id+"-"+this.currentPage);var goBack=1;while(!this.pageIsVisible(this.currentPage-goBack)&&(this.currentPage-goBack)>1){goBack++}this.currentPage-=goBack;var previousPage=document.getElementById("fsPage"+this.id+"-"+this.currentPage);if(this.currentPage==1){$("#fsPreviousButton"+this.id).hide()}else{$("#fsSaveIncomplete"+this.id).show()}this.updateProgress(this.currentPage);$("#fsCaptcha"+this.id).hide();$("#fsSubmitButton"+this.id).hide();var scope=this;$(currentPage).fadeOut(200,function(){$(currentPage).addClass("fsHiddenPage");$(".fsError").hide();$("#fsNextButton"+scope.id).show();$(previousPage).removeClass("fsHiddenPage");$(previousPage).show();if($("#fsHeaderImage").length<=0){$(document).scrollTop($(previousPage).offset().top-Number($(".fsForm").css("margin-top").replace("px","")))}else{$(document).scrollTop($("#fsHeaderImage").offset().top)}})};Formstack.Form.prototype.checkPage=function(pageNumber){if(!this.validate){return true}var currentPage=document.getElementById("fsPage"+this.id+"-"+this.currentPage);var fields=$(currentPage).find("input");var passed=0;for(var i=0;i<fields.length;i++){if(this.checkFormat(fields[i])){passed++}}var passedFormat=fields.length==passed;if(!passedFormat){return false}var fields=$(currentPage).find(".fsRequired");var passedRequired=true;var failedMatrix;var matrixFailed=false;for(var i=0;i<fields.length;i++){if(fields[i].disabled){continue}var pFieldName=fields[i].name.substr(0,fields[i].name.indexOf("-"));var currentMatrix;currentMatrix=document.getElementById("matrix-"+pFieldName);if((failedMatrix==currentMatrix)&&currentMatrix!=null){continue}if(!this.checkRequired(fields[i])){passedRequired=false;if(currentMatrix!=null){failedMatrix=currentMatrix}}}if(passedFormat&&passedRequired){$("#fsError"+this.id).remove()}return passedFormat&&passedRequired};Formstack.Form.prototype.initLogic=function(){for(var i=0;i<this.logicFields.length;i++){var fields=this.getFields(this.logicFields[i]);for(var j=0;j<fields.length;j++){var type=fields[j].type.toLowerCase();var event=type=="radio"||type=="checkbox"?"click":"change";$(fields[j]).bind(event,$.proxy(this.checkLogic,this));this.checkLogic(fields[j])}}};Formstack.Form.prototype.initCalculations=function(){for(var i=0;i<this.calcFields.length;i++){var id=this.calcFields[i];var fields=this.getFields(id);for(var j=0;j<fields.length;j++){var field=fields[j];var fieldType=field.type.toLowerCase();var evt=(fieldType=="radio"||fieldType=="checkbox")?"click":"change";$(field).bind(evt,$.proxy(this.updateCalculations,this))}var other=document.getElementById("field"+id+"_othervalue");if(other){$(other).bind("change",$.proxy(function(e){var field=document.getElementById("field"+id+"_other");if(field){field.checked=other.value!=""}this.updateCalculations(id)},this))}}for(var i=0;i<this.calculations.length;i++){this.evalCalculation(this.calculations[i])}};Formstack.Form.prototype.initFields=function(){$(".fsField").bind("change",$.proxy(this.checkFormat,this));$("input.fsOtherField").change(function(e){var id=$(this).attr("id").split("_")[0];$("#"+id+"_other").attr("checked",($(this).val()!=""))});$(".fsField").focus($.proxy(this.focus,this));$(".fsField").blur($.proxy(this.focus,this));$("div.fsCallout").each(function(index){$(this).hide()})};Formstack.Form.prototype.initMatrixes=function(){$("table.fsMatrixOnePerColumn input").each($.proxy(function(index,input){var fieldType=input.type.toLowerCase();if(fieldType=="radio"||fieldType=="checkbox"){$(input).click($.proxy(function(e){this.checkMatrixOnePerColumn(input.id)},this))}},this))};Formstack.Form.prototype.initSignatures=function(){$(".fsSignature").each($.proxy(function(index,input){var field_id=this.getFieldId(input.id);$(input).jSignature();$(input).bind("change",function(e){$("#field"+field_id).val($(e.target).jSignature("getData"))});$("#signatureClear"+field_id).bind("click",function(e){$(input).jSignature("reset")})},this))};Formstack.Form.prototype.initTextAreas=function(){$("textarea.fsTextAreaMaxLength").each($.proxy(function(index,textarea){var id=textarea.id.match(/(\d+)/)[1];var counter=document.getElementById("fsCounter"+id);var maxLength=0;if(counter){maxLength=parseInt(counter.innerHTML)}if(maxLength>0){$(textarea).keyup($.proxy(function(e){this.textareaCharLimiter(id,maxLength)},this));$(textarea).css("paddingBottom","24px");counter.innerHTML="";counter.style.display=""}},this))};Formstack.Form.prototype.initCalendars=function(){var divs=$("div .fsCalendar").get();for(var i=0;i<divs.length;i++){var div=divs[i];var id=div.id.match(/(\d+)/);id=id[1];var years=document.getElementById("field"+id+"Y").options;var minyear=parseInt(years[1].value,10);var maxyear=parseInt(years[years.length-1].value,10);var curyear=new Date().getFullYear();if(minyear<100){minyear+=minyear>curyear-2000?1900:2000}if(maxyear<100){maxyear+=2000}var format=document.getElementById("field"+id+"Format").value;var dateFormat="mm/dd/yy";if(format=="DMY"){dateFormat="dd/mm/yy"}else{if(format=="YMD"){dateFormat="yy/mm/dd"}else{if(format=="MY"){dateFormat="mm/yy/dd"}}}$("#"+div.id+"Link").datepicker({minDate:new Date(minyear,1,1),maxDate:new Date(maxyear,12,31),buttonImage:$("#fsCalendar"+id+"ImageUrl").html(),buttonImageOnly:true,beforeShow:this.calendarShow,onSelect:this.calendarSelect,showOn:"both",dateFormat:dateFormat,buttonText:"Select Date"})}};Formstack.Form.prototype.initAutocompletes=function(){$(".fsAutocomplete").each($.proxy(function(index,div){var id=div.id.match(/(\d+)/)[1];var input=document.getElementById("field"+id);var tags=document.getElementById("field"+id+"_options").value;$(input).autocomplete({source:tags.split("|")})}))};Formstack.Form.prototype.initSliders=function(){$(".fsSliderDiv").each($.proxy(function(index,div){var id=div.id.match(/(\d+)/)[1];var input=document.getElementById("field"+id);var num=this.getNumberProperties(input);if(!isNaN(num.min)&&!isNaN(num.max)){var slideval=document.getElementById(input.id+"-slidervalue");var defaultval=input.val!=""?parseFloat(input.value):num.min;if(isNaN(defaultval)){defaultval=num.min}$(div).slider({min:num.min,max:num.max,value:defaultval,form:this,num:num,field:input,slideval:slideval});if(!isNaN(num.decimals)){defaultval=defaultval.toFixed(num.decimals)}input.value=defaultval;slideval.innerHTML=defaultval;$(div).bind("slide",function(e,ui){var form=$(this).slider("option","form");var num=$(this).slider("option","num");var input=$(this).slider("option","field");var slideval=$(this).slider("option","slideval");var sliderval=ui.value;input.value=sliderval;slideval.innerHTML=sliderval;var id=input.id.match(/(\d+)/)[1];if(form.calcFields.indexOf(id)>=0){form.updateCalculations(id)}if(form.logicFields.indexOf(id)>=0){form.checkLogic(id)}})}},this))};Formstack.Form.prototype.initSaveResume=function(){$(".fsSaveIncomplete").click($.proxy(this.saveIncomplete,this))};Formstack.Form.prototype.initIOS=function(){$(".fsIOSUpload").click(function(e){e.stopPropagation();var id=e.target.id.match(/(\d+)/)[1];Formstack.IOS.fileUpload(id);return false})};Formstack.Form.prototype.init=function(){$("#fsForm"+this.id).submit($.proxy(this.submit,this));if(this.pages>1){$("#fsForm"+this.id).bind("keypress",$.proxy(function(e){if(e.keyCode!=13){return true}if(document.activeElement){if(document.activeElement.tagName=="TEXTAREA"){return true}this.updateCalculations(document.activeElement.id.substring(5));this.checkLogic(document.activeElement.id.substring(5))}if(this.page==this.pages){this.submitForm()}else{this.nextPage(this.page)}e.stopPropagation();return false},this))}this.initSignatures();this.initCalculations();this.initLogic();this.initFields();this.initMatrixes();this.initTextAreas();this.initCalendars();this.initAutocompletes();this.initSliders();this.initSaveResume();this.checkNavigation();this.updateProgress(1);if(!this.checkFreeLink()){return}this.initIOS()};Formstack.Form.prototype.checkNavigation=function(){var submitButton=document.getElementById("fsSubmitButton"+this.id);var nextButton=document.getElementById("fsNextButton"+this.id);var onLastPage=this.isLastPage(this.currentPage);submitButton.style.display=onLastPage?"":"none";nextButton.style.display=onLastPage?"none":""};Formstack.Form.prototype.focus=function(arg,hasFocus){if(/MSIE 6/i.test(navigator.userAgent)){return}var field=typeof arg=="object"&&"target" in arg?arg.target:arg;var hasFocus=hasFocus===undefined?arg.type=="focus":hasFocus;var container=this.getFieldContainer(field);if(!container){return}if(hasFocus){$(container).addClass("fsFieldFocused");this.showCallout(container,true)}else{$(container).removeClass("fsFieldFocused");this.showCallout(container,false)}};Formstack.Form.prototype.showCallout=function(field,show){var container=this.getFieldContainer(field);var callout=$("div.fsCallout",container).first();if(!callout){return}if(show){var fieldPosition=$(field).offset();var fieldHeight=Formstack.Util.getHeight(field);var fieldWidth=Formstack.Util.getWidth(field);$(callout).css("top",(fieldPosition.top+fieldHeight)+"px");$(callout).css("left",(fieldPosition.left+50)+"px");$(callout).css("marginTop","25px");$(callout).show("fast")}else{$(callout).hide("fast")}};Formstack.Form.prototype.fadeCallout=function(callout){var show=$(callout).hasStyle("fsCalloutShowing");if(show){$(callout).fadeIn()}else{$(callout).fadeOut()}};Formstack.Form.prototype.getLogicTarget=function(id){var e=document.getElementById("fsCell"+id);if(e==null){e=document.getElementById("fsSection"+id);if($(e).hasClass("fsFirstSection")){return e.parentNode}}return e};Formstack.Form.prototype.hasHiddenParents=function(id){var child=$("#"+id);var inHiddenContainer=false;var parentContainers=child.parents();for(var i=0;i<parentContainers.length;i++){var currentParent=parentContainers[i];if($(currentParent).is(".fsHidden, .fsHiddenPge")){inHiddenContainer=true;break}}return inHiddenContainer};Formstack.Form.prototype.showFields=function(id){var target=$(this.getLogicTarget(id));if(!target.is(".fsHidden, .fsHiddenPage")&&!target.hasClass("fsPage")){return}var is_section=target.hasClass("fsSection");var inputs=target.find("input,select,textarea");for(var i=0;i<inputs.length;i++){var input=inputs[i];if(input.disabled==true||$(target).is(".fsHidden, .fsHiddenPage")){var input_id=this.getFieldId(input);if(is_section){target.removeClass("fsHidden");var t=$(this.getLogicTarget(input_id));if(t.hasClass("fsHidden")){continue}}target.removeClass("fsHidden");if(target.hasClass("fsPage")){target.children(".fsFirstSection").removeClass("fsHidden")}target.parent().removeClass("fsHidden");if(!this.hasHiddenParents(input.id)){input.disabled=false}this.updateCalculations(input_id);this.checkLogic(input_id)}}var sigs=target.find(".fsSignature");for(i=0;i<sigs.length;i++){$(sigs[i]).empty();$(sigs[i]).jSignature()}if(inputs.length<=0){target.removeClass("fsHidden");if(target.hasClass("fsPage")){target.children(".fsFirstSection").removeClass("fsHidden")}target.parent().removeClass("fsHidden")}if(this.logicFields.indexOf(id)!=-1){this.checkLogic(id)}};Formstack.Form.prototype.hideFields=function(id){var target=$(this.getLogicTarget(id));var disabled_inputs=target.find("input:disabled,select:disabled,textarea:disabled");var inputs=target.find("input,select,textarea");if(target.is(".fsHidden, .fsHiddenPage")&&(disabled_inputs.length==inputs.length)){return}for(var i=0;i<inputs.length;i++){var input=inputs[i];if($(input).parent().is(".fsHidden")){continue}if(input.disabled==false){input.disabled=true;this.updateCalculations(this.getFieldId(input));this.checkLogic(this.getFieldId(input))}if(!target.hasClass("fsHidden")){target.addClass("fsHidden")}}if(inputs.length<=0){target.addClass("fsHidden")}if(this.logicFields.indexOf(id)!=-1){this.checkLogic(id)}};Formstack.Form.prototype.getCalculation=function(id){for(var i=0;i<this.calculations.length;i++){var calc=this.calculations[i];if(calc.fields.indexOf(id)>=0){return calc}}return null};Formstack.Form.prototype.getCalculationByTarget=function(target){for(var i=0;i<this.calculations.length;i++){var calc=this.calculations[i];if(calc.target==target){return calc}}return null};Formstack.Form.prototype.updateCalculations=function(arg){var id=typeof arg=="object"&&"target" in arg?this.getFieldId(arg.target):arg.toString();for(var i=0;i<this.calculations.length;i++){var calc=this.calculations[i];if(calc.fields.indexOf(id)>=0){this.evalCalculation(calc)}}};Formstack.Form.prototype.evalCalculation=function(calc){var equation=calc.equation;var unit="";for(var i=0;i<calc.fields.length;i++){var id=calc.fields[i];var regex=new RegExp("\\["+id+"\\]","g");var val=0;var fields=this.getFields(id);var fLength=fields.length;for(var j=0;j<fLength;j++){var field=fields[j];val=this.getCalcValue(this.getFieldId(field));if(val&&val.toString().indexOf("$")!=-1){unit="$"}}equation=equation.replace(regex,val)}var result=0;try{result=eval(equation)}catch(e){}field=document.getElementById("field"+calc.target);var old_value=field.value;if($(field).hasClass("fsFormatNumber")){field.value=result;this.checkFormat(field)}else{field.value=unit+result.toFixed(2)}jQuery(field).trigger("calceval");if(field.value!=old_value){this.checkLogic(calc.target);this.updateCalculations(calc.target)}};Formstack.Form.prototype.updateProgress=function(currentPage){var progressMeter=document.getElementById("fsProgress"+this.id);if(!progressMeter){return}var pages=$("div.fsPage").length;var totalPages=$(".fsProgressBarTotalPageNumber");for(var index=0;index<totalPages.length;++index){var element=totalPages[index];element.innerHTML=pages}var currentPages=$(".fsProgressBarCurrentPageNumber");for(var index=0;index<totalPages.length;++index){var element=currentPages[index];element.innerHTML=currentPage}if(pages<=1){progressMeter.style.display="none";return}var progressBarContainer=document.getElementById("fsProgressBarContainer"+this.id);var progressBar=document.getElementById("fsProgressBar"+this.id);var totalWidth=100;var ratio=currentPage/pages;if(ratio<0){ratio=0}if(ratio>1){ratio=1}var barWidth=(totalWidth*ratio)+"%";$(progressBar).css("width",barWidth)};Formstack.Form.prototype.pageIsVisible=function(page){var page=$("#fsPage"+this.id+"-"+page);if(page.hasClass("fsHidden")){return false}var sections=page.find("div.fsSection");for(var i=0;i<sections.length;i++){var section=$(sections[i]);if(section.hasClass("fsHidden")){continue}var cells=section.find("div.fsCell");for(var j=0;j<cells.length;j++){if(!$(cells[j]).hasClass("fsHidden")){return true}}}return false};Formstack.Form.prototype.calendarShow=function(input,calendar){var id=input.id.match(/(\d+)/);id=id[1];var cur=new Date;var monthSelect=document.getElementById("field"+id+"M");var month=monthSelect&&monthSelect.selectedIndex?monthSelect.selectedIndex:cur.getMonth()+1;var daySelect=document.getElementById("field"+id+"D");var day=daySelect&&daySelect.selectedIndex?daySelect.selectedIndex:cur.getDate();var yearSelect=document.getElementById("field"+id+"Y");var year=cur.getFullYear();if(yearSelect&&yearSelect.selectedIndex){var year=parseInt(yearSelect.options[yearSelect.selectedIndex].value,10);if(year<100){year+=2000}}var dateFormat=$(input).datepicker("option","dateFormat");dateFormat=dateFormat.replace("mm",month);dateFormat=dateFormat.replace("dd",day);dateFormat=dateFormat.replace("yy",year);$(input).datepicker("setDate",dateFormat)};Formstack.Form.prototype.calendarSelect=function(dateText,calendar){var id=calendar.id.match(/(\d+)/);id=id[1];var dateFormat=$(this).datepicker("option","dateFormat");var dates=dateText.split("/");var year=dates[2],month=dates[0],day=dates[1];if(dateFormat=="dd/mm/yy"){year=dates[2];month=dates[1];day=dates[0]}else{if(dateFormat=="yy/mm/dd"){year=dates[0];month=dates[1];day=dates[2]}else{if(dateFormat=="mm/yy/dd"){year=dates[1];month=dates[0];day=1}}}var monthSelect=document.getElementById("field"+id+"M");if(monthSelect){monthSelect.selectedIndex=month}var daySelect=document.getElementById("field"+id+"D");if(daySelect){daySelect.selectedIndex=day}var yearSelect=document.getElementById("field"+id+"Y");if(yearSelect){for(var y=1;y<yearSelect.options.length;y++){var value=parseInt(yearSelect.options[y].value,10);if(value<100){value+=2000}if(value==year){yearSelect.selectedIndex=y;break}}}};Formstack.Form.prototype.textareaCharLimiter=function(id,maxLength){var textarea=document.getElementById("field"+id);var counter=document.getElementById("fsCounter"+id);var text=textarea.value;if(text.length>maxLength){textarea.value=text.substr(0,maxLength)}counter.innerHTML=maxLength-textarea.value.length;var position=$(textarea).offset();var bottom=position.top+$(textarea).innerHeight();var right=position.left+$(textarea).innerWidth();$(counter).css("top",(bottom-Formstack.Util.getHeight(counter)-5)+"px");$(counter).css("left",(right-Formstack.Util.getWidth(counter)-5)+"px")};Formstack.Form.prototype.getFields=function(id){id=id.replace("field","");var fields=document.getElementsByName("field"+id);if(fields.length>0&&document.getElementById("field"+id+"_othervalue")!=null){var other=document.getElementById("field"+id+"_othervalue");fields[fields.length-1].value=other.value}return fields.length>0?fields:document.getElementsByName("field"+id+"[]")};Formstack.Form.prototype.getFieldId=function(input){input=typeof input!=="object"?input.toString():input;var id=typeof input==="string"?input:input.name.replace("field","");if(id==null){return""}id=id.match(/[0-9]+/);return id==null?"":id[0]};Formstack.Form.prototype.saveIncomplete=function(email){var resumeConfirm=document.getElementById("resumeConfirm");var message=(resumeConfirm)?resumeConfirm.innerHTML:"Are you sure you want to leave this form and resume later?";if(!confirm(message)){return}document.getElementById("incomplete"+this.id).value="true";document.getElementById("fsForm"+this.id).submit();return false};Formstack.Form.prototype.checkFreeLink=function(){var form=document.getElementById("fsForm"+this.id);if(!$(form).hasClass("fsFormFree")){return true}var doc;var type=document.getElementById("referrer_type"+this.id);switch(type.value){case"iframe":doc=window.parent.document;break;case"js":doc=window.document;break;default:return true}var found=false;var links=doc.getElementsByTagName("a");for(var i=0;i<links.length;i++){if((links[i].href.indexOf("http://www.formspring.com/")==0)||(links[i].href.indexOf("http://www.formstack.com/")==0)){found=true;break}}if(found){return true}var embedError=document.getElementById("embedError");var message=(embedError)?embedError.innerHTML:"There was an error displaying the form. Please copy and paste the embed code again.";this.showError(message);form.style.display="none";return false};Formstack.Form.prototype.checkMatrixOnePerColumn=function(id){var ids=id.split("-");var fieldID=ids[0];var rowID=ids[1];var colID=ids[2];$("#matrix-"+fieldID+" input").each($.proxy(function(index,input){var re=new RegExp("^"+fieldID+"-\\d+-"+colID+"$");if(input.id!=id&&re.test(input.id)){input.checked=false}},this))};Formstack.Form.prototype.onChange=function(){};Formstack.Form.prototype.getCalcValue=function(id){var fields=this.getFields(id);var sum=0;for(var i=0;i<fields.length;i++){var input=fields[i];if(input.disabled){sum+=0}else{if(input.type=="radio"||input.type=="checkbox"){sum+=input.checked?this.getNumber(input.value):0}else{if(input.type=="select-multiple"){for(var i=0;i<input.options.length;i++){if(input.options[i].selected){var value=this.getNumber(input.options[i].value);if(!isNaN(value)){sum+=value}}}}else{if(input.type=="select-one"){sum+=this.getNumber(input.options[input.selectedIndex].value)}else{sum+=this.getNumber(input.value)}}}}}return sum};Formstack.Form.prototype.getNumber=function(value){if($.trim(value)==""){return 0}var v=parseFloat(value);return isNaN(v)?parseFloat(value.replace(/[^\d\.\-]/g,"")):v};Formstack.Form.prototype.submit=function(event){if(!this.checkForm()){return false}if(this.jsonp){this.jsonpSubmit();return false}var submit_buttons=$("input.fsSubmitButton");if(submit_buttons.length){var e=document.getElementById("submittingText");submit_buttons[0].value=e&&e.innerHTML?e.innerHTML+"...":"Submitting..."}return true};Formstack.Form.prototype.checkForm=function(){var res=this.checkPage(this.pages);if(res){var hidden_fields=[];var fields=$("#fsForm"+this.id+" .fsRequired").get();for(var i=0;i<fields.length;i++){var field=fields[i];if(field.disabled){if(field.id.indexOf("_")>=0){var m=field.id.split("_");hidden_fields.push(m[0])}else{hidden_fields.push(field.name)}}}if(document.getElementById("hidden_fields"+this.id)){document.getElementById("hidden_fields"+this.id).value=hidden_fields.join(",")}return true}else{return false}};Formstack.Form.prototype.checkLogic=function(arg){var id=typeof arg=="object"&&"target" in arg?this.getFieldId(arg.target):this.getFieldId(arg);for(var i=0;i<this.checks.length;i++){if(this.checks[i].fields.indexOf(id)<0){continue}var check=this.checks[i];var test=false;for(var j=0;j<check.checks.length;j++){var fieldCheck=check.checks[j];if(fieldCheck.condition=="gt"){test=this.isFieldGreaterThan(fieldCheck.field,fieldCheck.option)}else{if(fieldCheck.condition=="lt"){test=this.isFieldLessThan(fieldCheck.field,fieldCheck.option)}else{test=this.isFieldEqual(fieldCheck.field,fieldCheck.option);if(fieldCheck.condition=="!="){test=!test}}}if(check.bool=="AND"&&!test){break}if(check.bool=="OR"&&test){break}}if((test&&check.action=="Show")||(!test&&check.action=="Hide")){this.showFields(check.target)}else{this.hideFields(check.target)}}this.checkNavigation()};Formstack.Form.prototype.getFieldValues=function(id){var values=new Array();var fields=this.getFields(id);for(var i=0;i<fields.length;i++){var input=fields[i];if(input.disabled){continue}if(input.type=="checkbox"||input.type=="radio"){if(input.checked){values.push(input.value)}}else{if(input.type=="select-multiple"){for(var j=0;j<input.options.length;j++){if(input.options[j].selected){values.push(input.options[j].value)}}}else{values.push(input.value)}}}return values};Formstack.Form.prototype.isFieldEqual=function(id,value){var values=this.getFieldValues(id);return values.indexOf(value)!=-1};Formstack.Form.prototype.isFieldGreaterThan=function(id,value){return this.getCalcValue(id)>value};Formstack.Form.prototype.isFieldLessThan=function(id,value){return this.getCalcValue(id)<value};Formstack.Form.prototype.checkRequired=function(field){if(!this.validate||location.search.indexOf("no_req")>=0){return true}var showError=false;var skip=[];if(!field.disabled&&skip.indexOf(field.id)==-1){var pass=true;if($(field).hasClass("fsRequired")){var pFieldName=field.name.substr(0,field.name.indexOf("-"));var pMatrix=document.getElementById("matrix-"+pFieldName);var fieldValue=$(field).val();var signatureValueStart="data:image/png;base64,";var siblingSignatures=$(field).siblings(".fsSignature");if(pMatrix!=null){var inputs=pMatrix.getElementsByTagName("input");var columns=new Array(false);for(var j=0;j<inputs.length;j++){var hasRadio=false;var currentInput=inputs[j];var fieldType=currentInput.type.toLowerCase();if(fieldType=="radio"||fieldType=="checkbox"){if(fieldType=="radio"){hasRadio=true;pass=this.checkValidValue(currentInput)}if(!pass){break}var col=parseInt(inputs[j].id.substr(inputs[j].id.lastIndexOf("-")+1))-1;if(columns[col]==null){columns[col]=false}if(inputs[j].checked){columns[col]=true}}}if($(pMatrix).hasClass("fsMatrixOnePerColumn")){pass=true;for(var c=0;c<columns.length;c++){if(columns[c]==false){pass=false}}}else{if(!hasRadio){pass=false;for(var c=0;c<columns.length;c++){if(columns[c]==true){pass=true;break}}}}}else{if((fieldValue.indexOf(signatureValueStart)>=0)&&(siblingSignatures.length>0)){var clearedFirstTenChars="iVBORw0KGg";var clearedLastTenChars="lFTkSuQmCC";var clearedLength=3346;var actualFirstTenChars=fieldValue.substr(signatureValueStart.length,10);var actualLastTenChars=fieldValue.substr(fieldValue.length-10);if((actualFirstTenChars==clearedFirstTenChars)&&(actualLastTenChars==clearedLastTenChars)&&(clearedLength==fieldValue.length)){pass=false}else{pass=true}}else{pass=this.checkValidValue(field)}}if(!pass){showError=true;if($(field).hasClass("fsFieldAddress")){var id=field.id.split("-");id=id[0];skip.push(id+"-zip")}}}if(pass&&$(field).hasClass("fsUpload")){pass=this.checkUpload(field);if(!pass){showError=true}}this.highlightField(field,!pass)}if(showError){this.showError(document.getElementById("requiredFieldsError")?document.getElementById("requiredFieldsError").innerHTML:"Please fill in a valid value for all required fields");return false}return pass};Formstack.Form.prototype.showError=function(message){$("#fsError"+this.id).remove();var error=document.createElement("div");error.id="fsError"+this.id;error.className="fsError";error.innerHTML=message;error.setAttribute("role","alert");$(error).prependTo("#fsForm"+this.id);Formstack.Util.scrollTo("#fsError"+this.id)};Formstack.Form.prototype.highlightField=function(field,on,msg){var container=this.getFieldContainer(field);if(msg==null){msg=""}if(on){$(container).addClass("fsValidationError")}else{$(container).removeClass("fsValidationError")}if(this.hasHtml5Validation){field.setCustomValidity(msg)}};Formstack.Form.prototype.getContainer=function(field,cls){var container=field;while(container&&container.tagName&&container.tagName.toLowerCase()!="body"){if($(container).hasClass(cls)){return container}container=container.parentNode}return};Formstack.Form.prototype.getFieldContainer=function(field){return this.getContainer(field,"fsFieldCell")};Formstack.Form.prototype.checkValidValue=function(field){var bad=false;var id=this.getFieldId(field);switch(field.type.toLowerCase()){case"text":if($(field).hasClass("fsFieldName")){var id=field.id.split("-");id=id[0];bad=!document.getElementById(id+"-first").value.match(/\S/)||!document.getElementById(id+"-last").value.match(/\S/);if(!bad){var prefix=document.getElementById(id+"-prefix");if(prefix){bad=!prefix.value.match(/\S/)}}if(!bad){var suffix=document.getElementById(id+"-suffix");if(suffix){bad=!suffix.value.match(/\S/)}}if(!bad){var middle=document.getElementById(id+"-middle");if(middle){bad=!middle.value.match(/\S/)}}if(!bad){var initial=document.getElementById(id+"-initial");if(initial){bad=!initial.value.match(/\S/)}}}else{if($(field).hasClass("fsFieldAddress")){var id=field.id.split("-");id=id[0];bad=!document.getElementById(id+"-address").value.match(/\S/)||!document.getElementById(id+"-city").value.match(/\S/)||!document.getElementById(id+"-zip").value.match(/\S/);if(!bad){var state=document.getElementById(id+"-state");if(state.type.toLowerCase()=="select-one"){bad=!state.options[state.selectedIndex].value.match(/\S/)}else{bad=!state.value.match(/\S/)}}if(!bad){var country=document.getElementById(id+"-country");if(country==null){break}if($(country).is("[type=hidden]")){bad=!country.value.match(/\S/)}else{if(country&&!country.options[country.selectedIndex].value.match(/\S/)){bad=true}}}}else{bad=!field.value.match(/\S/)}}break;default:var vals=this.getFieldValues(field.name);if(vals[0]==null||vals[0]==""){bad=true}break}return !bad};Formstack.Form.prototype.checkUpload=function(field){var pass=true;var types=[];var classNames=field.className.split(/\s+/);for(var j=0;j<classNames.length;j++){var className=classNames[j];if(/^uploadTypes-/.test(className)){var m=className.split("-");types=m[1].split(",")}}for(var j=0;j<types.length;j++){types[j]=types[j].toLowerCase()}if(types.indexOf("*")<0&&field&&field.value!=""&&!field.disabled){var ext=field.value.match(/\.(\w+)$/);pass=ext&&types.indexOf(ext[1].toLowerCase())>=0?true:false;if(!pass){this.highlightField(field,true);var msg=document.getElementById("fileTypeAlert")?$("#fileTypeAlert").innerHTML:"You must upload one of the following file types for the selected field:";alert(msg+types.join(", "))}}return pass};Formstack.Form.prototype.checkFormat=function(arg){var field=typeof arg=="object"&&"target" in arg?arg.target:arg;if(field.value==""||field.disabled){return true}var classes=field.className.split(/\s+/);var hasFormat=false;var formatted=false;for(var i=0;i<classes.length;i++){if(classes[i].indexOf("fsFormat")!=0){continue}hasFormat=true;var formatter="check"+classes[i].slice(2);if(typeof this[formatter]==="function"){var formatted=this[formatter](field);if(!formatted){break}}else{console.warn(formatter+" formatter function not found.")}}var pass=!hasFormat||(hasFormat&&formatted);if(hasFormat){this.highlightField(field,!pass)}return pass};Formstack.Form.prototype.checkFormatEmail=function(field){var confirmField=null;if(field.id.indexOf("_confirm")>-1){confirmField=field;field=document.getElementById(field.id.replace("_confirm",""))}else{confirmField=document.getElementById(field.id+"_confirm")}if(confirmField){if(confirmField.value!=field.value){return false}if(!confirmField.value.match(/^\s*\S+\@[\w\-\.]+\.\w+\s*$/)){return false}}return field.value.match(/^\s*\S+\@[\w\-\.]+\.\w+\s*$/)};Formstack.Form.prototype.getPhoneParts=function(str){var val=str.toLowerCase().replace(/[^\dx]/g,"");var ext="";if(val.indexOf("x")>=0){var parts=val.split("x");val=parts[0];ext=parts[1]}if(val.charAt(0)=="1"){val=val.slice(1)}return[val,ext]};Formstack.Form.prototype.checkFormatPhoneUS=function(field){var parts=this.getPhoneParts(field.value);var val=parts[0];var ext=parts[1];if(val.length!=10){return false}field.value="("+val.substr(0,3)+") "+val.substr(3,3)+"-"+val.substr(6,4);if(ext.length){field.value+=" x"+ext}return true};Formstack.Form.prototype.checkFormatPhoneUK=function(field){var parts=this.getPhoneParts(field.value);var val=parts[0];var ext=parts[1];if(val.substr(0,2)=="44"){val=val.slice(2);if(val.charAt(0)!="0"){val="0"+val}}if(val.charAt(0)!="0"||(val.length!=10&&val.length!=11)){return false}if((val.charAt(1)=="1"&&(val.charAt(2)=="1"||val.charAt(3)=="1"))||(val.charAt(1)=="8")){field.value=val.substr(0,4)+" "+val.substr(4,3)+" "+val.substr(7,val.length-7)}else{if(val.charAt(1)=="2"||val.charAt(1)=="3"||val.charAt(1)=="5"){field.value=val.substr(0,3)+" "+val.substr(3,4)+" "+val.substr(7,val.length-7)}else{field.value=val.substr(0,5)+" "+val.substr(5,val.length-5)}}if(ext.length){field.value+=" x"+ext}return true};Formstack.Form.prototype.checkFormatPhoneAU=function(field,val){var parts=this.getPhoneParts(field.value);var val=parts[0];var ext=parts[1];if(val.substr(0,2)=="61"){val=val.slice(2);if(val.charAt(0)!="0"){val="0"+val}}if(val.charAt(0)!="0"||val.length!=10){return false}field.value="("+val.substr(0,2)+") "+val.substr(2,4)+" "+val.substr(6,4);if(ext.length){field.value+=" x"+ext}return true};Formstack.Form.prototype.checkFormatPhoneXX=function(field){return/\d{3,}/.test(field.value)};Formstack.Form.prototype.checkFormatZipUS=function(field){var val=field.value.replace(/^\s+/,"").replace(/\s+$/,"");if(!val.match(/^\d{5}(?:\-\d{4})?$/)){return false}field.value=val;return true};Formstack.Form.prototype.checkFormatZipXX=function(field){return field.value!=""};Formstack.Form.prototype.checkFormatZipCA=function(field){var val=field.value.replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s{2,}/," ").toUpperCase();if(val.length==6&&!val.match(/\s/)){val=val.substr(0,3)+" "+val.substr(3,3)}if(!val.match(/^[A-Z]\d[A-Z] \d[A-Z]\d$/)){return false}field.value=val;return true};Formstack.Form.prototype.checkFormatZipUK=function(field){var val=field.value.replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s{2,}/," ").toUpperCase();if(!val.match(/\s/)){val=val.substr(0,val.length-3)+" "+val.substr(val.length-3,3)}if(!val.match(/^[A-Z]{1,2}[0-9R][0-9A-Z]? [0-9][ABD-HJLNP-UW-Z]{2}$/)){return false}field.value=val;return true};Formstack.Form.prototype.checkFormatZipAU=function(field){var val=field.value.replace(/^\s+/,"").replace(/\s+$/,"").toUpperCase();if(!val.match(/^\d{4}$/)){return false}field.value=val;return true};Formstack.Form.prototype.checkFormatNumber=function(field){var val=parseFloat(field.value.replace(/[^\d\.\-]/g,""));if(isNaN(val)){return false}var number=this.getNumberProperties(field);if((!isNaN(number.min)&&val<number.min)||(!isNaN(number.max)&&val>number.max)){return false}field.value=isNaN(number.decimals)?value:val.toFixed(number.decimals);return true};Formstack.Form.prototype.checkFormatCreditCard=function(field){var val=field.value.replace(/\D/g,"");var checksum=0;var multiplier=1;field.value=val;for(var i=val.length-1;i>=0;i--){var calc=parseInt(val.charAt(i))*multiplier;checksum+=(calc>9)?calc-9:calc;multiplier=multiplier==1?2:1}if(checksum%10!=0){return false}if(val.match(/^4/)){return $(field).hasClass("fsAcceptVisa")&&(val.length==13||val.length==16)}else{if(val.match(/^(?:51|52|53|54|55)/)){return $(field).hasClass("fsAcceptMasterCard")&&val.length==16}else{if(val.match(/^(?:6011|622|64|65)/)){return $(field).hasClass("fsAcceptDiscover")&&val.length==16}else{if(val.match(/^(?:34|37)/)){return $(field).hasClass("fsAcceptAmex")&&val.length==15}else{if(val.match(/^(?:300|301|302|303|304|305|36|54|55)/)){return $(field).hasClass("fsAcceptDiners")&&(val.length==14||val.length==16)}else{if(val.match(/^35/)){return $(field).hasClass("fsAcceptJCB")&&val.length==16}else{return false}}}}}}};Formstack.Form.prototype.getNumberProperties=function(field){var num={min:NaN,max:NaN,decimals:NaN};var classNames=field.className.split(/\s+/);for(var i=0;i<classNames.length;i++){var className=classNames[i];var match;if(match=className.match(/^fsNumberMin-([\-\d]+)/)){num.min=parseInt(match[1])}else{if(match=className.match(/^fsNumberMax-([\-\d]+)/)){num.max=parseInt(match[1])}else{if(match=className.match(/^fsNumberDecimals-([\d]+)/)){num.decimals=parseInt(match[1])}}}}return num};Formstack.Form.prototype.generatePrePopulateLink=function(){var link=document.location.href;if(link.indexOf("?")<0){link+="?"}var fields=$(".fsField");for(var i=0;i<fields.length;i++){var field=fields[i];if($(field).hasClass("fsFormatCreditCard")){continue}var val=this.getValue(field);if(val==null||val==""){continue}name=field.name!=null?field.name:field.id;link+="&"+name+"="+encodeURIComponent(val)}document.getElementById("form"+this.id+"PrePopulateLink").value=link;document.getElementById("form"+this.id+"PrePopulateDiv").style.display="block"};Formstack.Form.prototype.getValue=function(input){if(input.disabled){return null}else{if(input.type=="radio"||input.type=="checkbox"){return input.checked?input.value:null}else{if(input.type=="select-one"){return input.options[input.selectedIndex].value}else{return input.value}}}};Formstack.Form.prototype.copyFieldValue=function(from,to){var fields=$(".fsField");console.log("dupa"+fields);for(var i=0;i<fields.length;i++){var field=fields[i];if(field.id.indexOf("field"+from)>-1){var ext=field.id.replace("field"+from,"");var fieldTo=document.getElementById("field"+to+ext)==null?document.getElementById("field"+to):document.getElementById("field"+to+ext);if(fieldTo.type=="radio"||fieldTo.type=="checkbox"){fieldTo.checked=field.checked}else{fieldTo.value=field.value}}}};Formstack.Form.prototype.determineLocation=function(){if(navigator.geolocation){try{navigator.geolocation.watchPosition(function(position){$('input[name="latitude"]').val(position.coords.latitude);$('input[name="longitude"]').val(position.coords.longitude)},function(error){},{enableHighAccuracy:true,maximumAge:60000,timeout:10000})}catch(err){}}};Formstack.Form.prototype.toggleValidation=function(link){console.log(this.id);if(this.validate){this.validate=false;$(link).html("Turn On Validation");document.getElementById("fsSubmitButton"+this.id).disabled=true}else{this.validate=true;$(link).html("Turn Off Validation");document.getElementById("fsSubmitButton"+this.id).disabled=false}};Formstack.Form.prototype.onPostSubmit=function(response){if(response.message==null||response.message==""){response.message="Thank You!"}var html='<div align="center" style="font-size:16px;font-weight:bold;padding:25px;">';html+=response.message;html+="</div><br />";$("#fsForm"+this.id).html(html)};Formstack.Form.prototype.onSubmitError=function(response){if(response.error){this.showError(response.error)}};Formstack.Form.prototype.jsonpSubmit=function(){var form=document.getElementById("fsForm"+this.id);var callback="form"+this.id+".onPostSubmit";var script=document.createElement("script");script.src=form.action+"?jsonp&"+$(form).serialize()+"&nocache="+(new Date).getTime();form.parentNode.insertBefore(script,form);return false};Formstack.IOS={};Formstack.IOS.getRectById=function(id){var element=document.getElementById(id);if(element){var rect=element.getBoundingClientRect();return"{{"+rect.left+","+rect.top+"}, {"+rect.width+","+rect.height+"}}"}else{return null}};Formstack.IOS.base64EncodedUpload=function(id,imageData){var input=document.getElementById("field"+id);var button=document.getElementById("field"+id+"-ios-button");if(!input){return 0}if(button){button.innerHTML="Change file"}input.value=imageData;var img=document.getElementById("field"+id+"Preview");img.src="data:image/jpeg;base64,"+imageData;return 1};Formstack.IOS.fileUpload=function(id){var url="ios://fileupload/"+id;window.location=url};Formstack.Util={lcFirst:function(str){return str[0].toLowerCase()+str.slice(1)}};Formstack.Util.checkAll=function(el){var prefix=el.name.replace("_all","_");var i=1;var e;var checkboxes=document.getElementsByName(el.name.replace("_all","[]"));for(var i=0;i<checkboxes.length;i++){e=checkboxes[i];e.checked=el.checked}var form=document.getElementsByName("form");form=form[0];var id=prefix.replace("field","");id=id.replace("_","");eval("form"+form.value+".checkLogic("+id+")");eval("form"+form.value+".updateCalculations("+id+")")};Formstack.Util.scrollTo=function(el){var p=$(el).offset();var marginTop=$(el).css("margin-top");var marginLeft=$(el).css("margin-left");marginTop=Number(marginTop.replace("px",""));marginLeft=Number(marginLeft.replace("px",""));window.scroll(p.left-marginLeft,p.top-marginTop)};Formstack.Util.getHeight=function(el){var height=$(el).height();return isNaN(height)?0:height};Formstack.Util.getWidth=function(el){var width=$(el).width();return isNaN(width)?0:width};Formstack.Util.setDate=function(field){var nowDate=new Date();var yearField=document.getElementById("field"+field+"Y");if(yearField){var yearLength=yearField.options[1].value.length;var year=nowDate.getFullYear().toString();yearField.value=year.substring(4-yearLength)}var monthField=document.getElementById("field"+field+"M");if(monthField){monthField.selectedIndex=nowDate.getMonth()+1}var dayField=document.getElementById("field"+field+"D");if(dayField){var day=nowDate.getDate();dayField.value=(day<10)?"0"+day:day}};Formstack.Util.setTime=function(field){var nowDate=new Date();var hour=nowDate.getHours();var hourField=document.getElementById("field"+field+"H");if(hourField){var tmpHour=hour;if(hourField.options.length<=13&&hour>12){tmpHour=tmpHour-12}hourField.value=(tmpHour<10)?"0"+tmpHour:tmpHour}var minutesField=document.getElementById("field"+field+"I");if(minutesField){var minutes=nowDate.getMinutes();minutesField.value=(minutes<10)?"0"+minutes:minutes}var secondsField=document.getElementById("field"+field+"S");if(secondsField){var seconds=nowDate.getSeconds();secondsField.value=(seconds<10)?"0"+seconds:seconds}var ampmField=document.getElementById("field"+field+"A");if(ampmField){if(hour>12){ampmField.selectedIndex=2;hour-=12}else{ampmField.selectedIndex=1}}};window.Formstack=Formstack})(window,jQuery);